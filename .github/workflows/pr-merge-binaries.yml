name: Build Binaries on PR Merge

on:
  push:
    branches:
      - main
      - 'release-*'

jobs:
  # Build binaries using reusable workflow
  build-binaries:
    uses: ./.github/workflows/build-binaries.yml
    with:
      artifact_prefix: "pr-merge"
      upload_artifacts: true

  # Store build metadata for potential use
  store-build-info:
    name: Store Build Information
    runs-on: ubuntu-latest
    needs: [build-binaries]
    steps:
      - name: Create build info
        run: |
          echo "Build Information" > build-info.txt
          echo "==================" >> build-info.txt
          echo "Commit: ${{ github.sha }}" >> build-info.txt
          echo "Branch: ${{ github.ref_name }}" >> build-info.txt
          echo "Timestamp: $(date -u)" >> build-info.txt
          echo "Run ID: ${{ github.run_id }}" >> build-info.txt
          echo "Actor: ${{ github.actor }}" >> build-info.txt

      - name: Upload build info
        uses: actions/upload-artifact@v4
        with:
          name: pr-merge-build-info
          path: build-info.txt
          retention-days: 30